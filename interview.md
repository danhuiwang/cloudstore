这个是我在进入七牛云实习时期一边学习go语言，一边写的一个小项目。项目里面包含文件的上传、分块上传、秒传、下载、断点续传、文件分享等功能。在文件上传成功之后还会通过mq异步地将文件迁移至七牛 `KODO` 对象存储，实现文件系统的高可用。

分块上传优势如下：

- 在弱网络环境中，使用较小的分块可以将网络失败导致的中断影响降低，任意分块传输失败，都可以重新传输当前分块，不会影响其他分块和内容完整性。
- 在高带宽环境中，并发上传文件分块能充分利用网络带宽，上传时，这组分块将会按连续的序号编号，所有分块上传完毕后，会根据分块编号顺序合并成完整的文件，所以乱序上传并不影响合并后的文件。
- 在未知文件总大小的情况下，可以先发起上传，再组合文件以获得完整大小。

分块上传步骤：

1. 客户端调用 `Initiate Multipart Upload` 接口，初始化分块上传操作，服务端计算出文件的上传ID `UploadID` 存入Redis后返回给客户端。
2. 客户端对文件进行分块读取，并对每一个分块分别调用 `Upload Part` 接口进行上传，传递分块的内容，分块编号`PartNumber`，分块大小`Content-Length`等信息，服务端将上传ID、分块编号、分块大小等信息写入Redis，并在分块上传成功后更新`redis`中的信息，记录成功状态以及计算出的文件分块的`MD5`值。
3. 客户端在全部分块上传完毕后，调用 `Complete Multipart Upload` 接口，对所有分块进行合并操作，传递每个分块的 `PartNumber` 以及 `MD5`值，服务端验证传输是否出错，如果成功，则进行合并，并返回成功信息，否则，将传输出错的分块编号返回给客户端，进行分块重传，最后再次尝试合并操作直至成功。

秒传：

- 在文件上传时，先进行一次 `TryFastUpload` 接口的调用，传递文件的大小，`MD5`值，文件名称等信息，尝试进行秒传。如果服务端查询出数据库中有和传递信息一致的文件，则直接进行秒传操作，将目标文件指向之前已经上传过的文件即可，否则进行普通上传。

断点续传的优势：

- 客户端能够实现`分段下载`, 中断传输后只要记住上次下载的位置, 就能够`续传`而不需要重传。
- 客户端可以实现`进度条展示`, 能够手动`暂停传输`和`继续传输`。

- 在进行文件下载的时候，可以进行断点续传操作，在请求头中加入 `Range: bytes=first-last` 信息，服务端将会把客户端请求中 `Range` 字段所指定的数据响应给用户，并且响应头部中包含`Content-Range: bytes first-last/totle`以及 `Content-Length: last - first + 1` 等信息。